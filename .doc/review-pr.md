# PR Review Command

このブランチのプルリクエストを以下の観点でレビューします：

## レビュー観点

### 1. 可読性

- わかりにくい部分にコメントがあるか
- 初見の人でもわかりやすい命名がされているか
- 冗長なコーディングがないか（ショートハンドの使用）
- 不要なコードや開発用の一時的なデバッグログが残っていないか
- 開発範囲でわかりにくいコードがないか
- ロジックが分散せず凝集しているか
- 責務を意識してファイルやディレクトリが分けられているか

### 2. バグを減らす

- tsconfigやBiomeに従っているか
- `any`、`as`が使われていないか（極力禁止）
- null/undefined安全に書かれているか
- 引数がオプショナルになりすぎていないか
- 関数型プログラミングっぽく書かれているか（イミュータブル）
- `let`、`var`、空配列pushが使われていないか（禁止）

### 3. その他

- 基本的に`名前付きexport`を使い、`export default`を使っていないか（`/pages`と`/app`のpage.tsx、layout.tsxを除く）

### 4. セキュリティ・データ整合性

- **権限チェック**: 削除・更新・参照時に適切な権限チェックが行われているか
- **API設計**: クライアントに渡すべき情報か？機密情報が含まれていないか？
- **エラーハンドリング**: 適切なエラーハンドリングが実装されているか
- **SQL インジェクション対策**: Prismaを使用している場合は問題ないが、生SQLを書いている場合は要注意

### 5. DRY原則（Don't Repeat Yourself）

- **重複コード検出**: 同じようなコードが複数箇所に存在していないか
- **共通化の提案**: 共通ロジックを関数・Hooks・ユーティリティとして抽出できないか
- **重複した型定義**: 同じ型定義が複数ファイルに存在していないか（`types/`に集約）
- **重複したスタイル**: 同じCSSが複数箇所に存在していないか（MaterialUIのテーマや`const/`に集約）
- **コピペコード**: わずかな違いで同じようなコードが繰り返されていないか
- **再利用性**: コンポーネントやユーティリティが十分に再利用可能な形になっているか

### 6. アンチパターン検出

- **マジックナンバー**: 定数化されていない数値が使われていないか
- **ハードコーディング**: 環境変数で管理すべき値がハードコーディングされていないか
- **God Object**: 一つのファイル/クラスに責務が集中しすぎていないか
- **Deep Nesting**: ネストが深すぎないか（3階層以上は警告）
- **Long Method**: 関数が長すぎないか（50行以上は警告）
- **Large Class/File**: ファイルが大きすぎないか（300行以上は警告）
- **Dead Code**: 使用されていないコード、import、変数が残っていないか

<!-- ### 7. バックエンドAPI実装（tRPC）
- **Router層**: プロシージャの定義、入力バリデーション（Zodスキーマ）、適切なエラーハンドリング（TRPCError）
- **Schema層**: `server/schema`にZodスキーマが適切に定義されているか
- **Service層**: ビジネスロジックの記述、データ整形
- **Repository層**: Prismaクライアント操作、エラーハンドリング
- **型推論**: tRPCの型推論を活用し、手動で型定義を重複させていないか（`inferRouterOutputs`等を使用）
- **レスポンス型**: クライアントに渡してよい情報のみが含まれているか（パスワード、トークンなどの機密情報が含まれていないか）
- **Middleware**: 認証・認可のミドルウェアが適切に使用されているか（`protectedProcedure`等） -->

### 8. フロントエンド実装

- **グローバル変数**: できるだけグローバル変数を持っていないか
- **ステート管理**: できるだけステートを持っていないか
- **Hooks使用**: useState、useEffectが適切に使われているか
- **キャッシュ設定**: `staleTime`、`gcTime`が適切に設定されているか
- **楽観的更新**: 必要に応じて楽観的更新（Optimistic Update）が実装されているか
- **Prefetch**: ユーザー体験向上のためにPrefetchが適切に使われているか
- **コンポーネント分割**: 適切な粒度でコンポーネントが分割されているか
- **App Router**: `app/`ディレクトリ内でServer ComponentsとClient Componentsが適切に使い分けられているか

<!-- ### 9. Prisma
- **マイグレーション**: マイグレーションファイルが適切に作成され、必ず名前がつけられているか
- **リレーション**: 適切なリレーションが設定されているか
- **onDelete**: Cascade、SetNull、Restrictが適切に設定されているか
- **インデックス**: パフォーマンスのために必要なインデックスが設定されているか -->

## レビュー手順

1. 現在のブランチに関連するPRを特定
2. PR内の変更ファイルを確認
3. 各ファイルを上記観点でレビュー
4. 重要度別（Critical/Medium/Minor）に問題点を整理
5. 具体的なコード例と改善案を提示
6. 総評とマージ前に対応すべき項目を明示

## 出力形式

以下の形式でレビュー結果を出力してください：

```markdown
# PR #[番号] [タイトル] のレビュー結果

## 全体評価

[総評を3-5文で記載]

## 🎯 主要なレビュー観点

### ✅ 良い点

[良かった点を箇条書き]

## ⚠️ 改善提案

### 🔴 Critical（重要度:高）

#### 1. [問題のタイトル]

**場所:** `ファイルパス:行番号`
**問題点:** [具体的な問題点]
**改善案:** [コード例付きの改善案]

### 🟡 Medium（重要度:中）

[同様の形式]

### 🟢 Minor（重要度:低）

[同様の形式]

## 📋 チェックリスト

[PR作成者が挙げたレビュー観点に対する回答]

## 🎓 総評

[マージ可否の判断と優先対応項目]
```

それでは、このブランチのPRをレビューしてください。
