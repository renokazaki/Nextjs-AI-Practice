# Next.js コードレビュー AI 依頼手順書

> CursorやCopilotなどのAIにNext.js/Reactのコードレビューを依頼する際の手順書  
> 目的: コード品質の担保とNext.js/Reactの正しい実装の確認

## 📋 基本的な使い方

### 1. レビュー依頼の基本フォーマット

```
以下のコードをNext.js 15 / React 19のベストプラクティスに基づいてレビューしてください。

【レビュー観点】
- [チェックしたい観点を選択]

【コード】
[ここにコードを貼り付け]

【コンテキスト】
- このコードの目的: [説明]
- 想定される使用シーン: [説明]
```

---

## 🔍 レビュー観点別チェックリスト

### 1. ディレクトリ構成・基本ルール

#### レビュー観点

- [ ] App Routerの規約に準拠しているか
- [ ] ファイル/フォルダの命名規則は適切か
- [ ] Route Groups、Parallel Routes、Intercepting Routesの使い分けは適切か
- [ ] 特殊ファイル（layout.tsx, page.tsx, loading.tsx, error.tsx等）は適切に配置されているか
- [ ] Private Folders（\_folder）の使用は適切か

#### AIへの依頼プロンプト例

```
このディレクトリ構成をレビューしてください。
Next.js 15のApp Routerの規約に準拠しているか、
ファイル配置やフォルダ構成が適切かを確認してください。

特に以下を重点的にチェック:
- 特殊ファイル（layout, page, loading, error等）の配置
- Route Groups/Parallel Routes/Intercepting Routesの使用
- コロケーション（関連ファイルの配置）の妥当性
```

---

### 2. コンポーネント設計

#### レビュー観点

- [ ] Server ComponentとClient Componentの使い分けは適切か
- [ ] 'use client'ディレクティブの配置は最適か
- [ ] コンポーネントの責務は単一か（Single Responsibility）
- [ ] Propsの型定義は適切か
- [ ] 不要な再レンダリングは発生していないか
- [ ] Composition（合成）による拡張性は考慮されているか
- [ ] Children Propを適切に活用しているか

#### AIへの依頼プロンプト例

```
このコンポーネントをレビューしてください。

チェック項目:
1. Server/Client Componentの使い分けは適切ですか？
2. 'use client'は必要最小限の場所に配置されていますか？
3. コンポーネントの責務は明確で単一ですか？
4. Props型定義は適切ですか？
5. 不要な再レンダリングが発生していませんか？
6. Compositionパターンを活用できていますか？

特に、このコンポーネントはServer Componentにできる可能性があれば提案してください。
```

---

### 3. データ取得

#### レビュー観点

- [ ] Server Componentでのデータ取得を優先しているか
- [ ] fetch APIのキャッシュオプションは適切か
- [ ] 並列データ取得（Promise.all）を活用しているか
- [ ] Streaming（Suspense）は適切に使用されているか
- [ ] エラーハンドリングは実装されているか
- [ ] Loading UIは適切に配置されているか
- [ ] Waterfall問題は回避されているか

#### AIへの依頼プロンプト例

```
このデータ取得ロジックをレビューしてください。

チェック項目:
1. Server Componentで取得できるデータですか？
2. fetchのキャッシュオプション（cache, next.revalidate）は適切ですか？
3. 複数のデータ取得がWaterfallになっていませんか？
4. Suspenseを使ったStreamingは検討されていますか？
5. エラーハンドリングは実装されていますか？
6. Loading状態は適切に管理されていますか？

パフォーマンス改善の余地があれば具体的に提案してください。
```

---

### 4. データ更新（Server Actions）

#### レビュー観点

- [ ] Server Actionsを適切に使用しているか
- [ ] 'use server'ディレクティブの配置は適切か
- [ ] フォームバリデーションは実装されているか
- [ ] エラーハンドリングは実装されているか
- [ ] Optimistic Updatesは検討されているか
- [ ] revalidatePath/revalidateTagでキャッシュ更新しているか
- [ ] セキュリティ（認証・認可）は考慮されているか

#### AIへの依頼プロンプト例

```
このServer Actionをレビューしてください。

チェック項目:
1. Server Actionsの実装は適切ですか？
2. フォームバリデーションは実装されていますか？（zodなど）
3. エラーハンドリングは十分ですか？
4. キャッシュの再検証（revalidatePath/revalidateTag）は適切ですか？
5. Optimistic Updatesを検討すべきケースですか？
6. セキュリティ面で問題はありませんか？

改善案があれば具体的なコード例を提示してください。
```

---

### 5. 状態管理

#### レビュー観点

- [ ] URL State（searchParams）を優先しているか
- [ ] Server ComponentでのState管理を最小化しているか
- [ ] Client Stateは適切なスコープで管理されているか
- [ ] useStateの使用は必要最小限か
- [ ] グローバルステート管理の導入は本当に必要か
- [ ] Context APIの使用は適切か
- [ ] 状態のリフトアップは適切か

#### AIへの依頼プロンプト例

```
この状態管理の実装をレビューしてください。

チェック項目:
1. URL State（searchParams）で管理できる状態ですか？
2. Server Componentで管理できませんか？
3. 状態のスコープは適切ですか？（グローバル化しすぎていないか）
4. useStateの使用は必要最小限ですか？
5. Context APIや状態管理ライブラリの使用は本当に必要ですか？
6. Prop Drillingの問題はありますか？

よりシンプルな実装方法があれば提案してください。
```

---

### 6. キャッシュ戦略

#### レビュー観点

- [ ] fetchのキャッシュオプションは適切か
- [ ] 動的レンダリングと静的レンダリングの選択は適切か
- [ ] revalidateの設定値は適切か
- [ ] unstable_cacheの使用は適切か
- [ ] キャッシュタグの設計は適切か
- [ ] Data Cacheとfull route cacheの使い分けは理解されているか

#### AIへの依頼プロンプト例

```
このキャッシュ戦略をレビューしてください。

チェック項目:
1. fetchのcacheオプション（force-cache, no-store等）は適切ですか？
2. next.revalidateの設定値は要件に合っていますか？
3. 動的レンダリングが必要なページで不要にforce-dynamicを使っていませんか？
4. unstable_cacheの使用は適切ですか？
5. キャッシュタグを使った効率的な再検証ができていますか？
6. キャッシュの挙動を正しく理解した実装ですか？

パフォーマンスとデータ鮮度のバランスについて評価してください。
```

---

### 7. エラーハンドリング

#### レビュー観点

- [ ] error.tsxで適切にエラーを捕捉しているか
- [ ] エラーバウンダリの配置は適切か
- [ ] ユーザーフレンドリーなエラーメッセージか
- [ ] 開発環境と本番環境でエラー情報を使い分けているか
- [ ] リトライ機能は実装されているか
- [ ] not-found.tsxは適切に配置されているか
- [ ] グローバルエラーハンドリング（global-error.tsx）は必要か

#### AIへの依頼プロンプト例

```
このエラーハンドリングをレビューしてください。

チェック項目:
1. error.tsxは適切な階層に配置されていますか？
2. エラーメッセージはユーザーフレンドリーですか？
3. 開発環境と本番環境で適切に情報を出し分けていますか？
4. リトライ機能は必要ですか？
5. 404エラーはnot-found.tsxで適切に処理されていますか？
6. エラーログの記録は実装されていますか？

エラーハンドリングの改善案を提示してください。
```

---

## 🎯 包括的なレビュー依頼テンプレート

### すべての観点を網羅する場合

```
# Next.js 15 / React 19 コードレビュー依頼

## レビュー対象
[ファイルパスやコンポーネント名]

## コード
[コードを貼り付け]

## 背景・目的
[このコードの目的や背景を簡潔に説明]

## レビュー観点
以下の観点でNext.js 15 / React 19のベストプラクティスに基づいてレビューしてください:

### 1. アーキテクチャ
- ディレクトリ構成は適切か
- Server/Client Componentの使い分けは適切か

### 2. パフォーマンス
- 不要な再レンダリングは発生していないか
- データ取得のWaterfall問題はないか
- キャッシュ戦略は適切か

### 3. データハンドリング
- データ取得方法は適切か
- Server Actionsの実装は適切か
- 状態管理は適切か

### 4. 品質
- エラーハンドリングは実装されているか
- 型定義は適切か
- セキュリティ面で問題はないか

### 5. 保守性
- コンポーネントの責務は単一か
- コードの可読性は高いか
- 再利用性は考慮されているか

## 期待する出力
1. 問題点の指摘（重要度: 高/中/低）
2. 具体的な改善案（コード例付き）
3. ベストプラクティスとの比較
```

---

## 📚 参考資料

### 学習リソース

- [Next.js 15 / React 19 実践設計ガイド](https://zenn.dev/k_mori/books/24320553af0956)
- [Next.js公式ドキュメント](https://nextjs.org/docs)
- [React公式ドキュメント](https://react.dev/)

### チェックすべき公式ガイドライン

1. **Server Componentの優先**: クライアント側の処理が不要な場合はServer Componentを使用
2. **'use client'の最小化**: 必要な箇所にのみ配置（Tree全体がClient Componentになることを避ける）
3. **データ取得の最適化**: Waterfallを避け、並列データ取得とStreamingを活用
4. **キャッシュの理解**: デフォルトの挙動を理解し、適切にオプトアウト
5. **Server Actionsの活用**: フォーム送信やデータ更新はServer Actionsで実装

---

## 💡 レビュー時のTips

### よくある指摘事項

#### ❌ 避けるべきパターン

```typescript
// Client Componentで不要にデータ取得
"use client";
export default function Page() {
  const [data, setData] = useState(null);
  useEffect(() => {
    fetch("/api/data").then((res) => setData(res));
  }, []);
  // ...
}
```

#### ✅ 推奨パターン

```typescript
// Server Componentでデータ取得
export default async function Page() {
  const data = await fetch('/api/data')
  return <ClientComponent data={data} />
}
```

### レビュー後のアクション

1. 指摘された問題点を優先度順に整理
2. 高優先度の問題から修正
3. 修正後、再度AIにレビューを依頼
4. リファクタリングの提案は段階的に適用

---

## 🔄 継続的な品質改善

### レビューの習慣化

- [ ] プルリクエスト作成前にAIレビューを実施
- [ ] 新機能追加時は該当する章のガイドラインを確認
- [ ] チーム内でレビュー結果を共有
- [ ] 頻出する問題をチームのコーディング規約に反映

### 定期的な見直し

- Next.jsのバージョンアップ時にガイドラインを更新
- 新しいベストプラクティスが登場したら取り入れる
- プロジェクト固有のルールを追加

---

**作成日**: 2025年10月23日  
**対象**: Next.js 15 / React 19  
**更新履歴**: v1.0 - 初版作成
